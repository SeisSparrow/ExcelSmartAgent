# 🎤 麦克风权限配置指南

如果遇到"**无法访问麦克风，请检查权限**"错误，请按以下步骤操作：

## 📋 快速检查清单

- [ ] 使用 `http://localhost:8000` 或 `http://127.0.0.1:8000` 访问（不要用 IP 地址）
- [ ] 使用 Chrome、Edge 或 Safari 浏览器
- [ ] 系统麦克风权限已授予浏览器
- [ ] 浏览器站点权限已允许麦克风
- [ ] 麦克风未被其他应用占用

---

## 1️⃣ 确认访问地址

**必须使用 localhost 或 127.0.0.1**，而不是其他 IP 地址。

✅ **正确**：
```
http://localhost:8000
http://127.0.0.1:8000
```

❌ **错误**：
```
http://192.168.x.x:8000  # 会被浏览器阻止
http://0.0.0.0:8000      # 会被浏览器阻止
```

---

## 2️⃣ macOS 系统权限设置

### 方法 1：通过系统设置
1. 打开 **系统设置** (System Settings)
2. 点击 **隐私与安全性** (Privacy & Security)
3. 点击 **麦克风** (Microphone)
4. 找到您的浏览器（Chrome、Safari、Edge 等）
5. **勾选**允许访问麦克风

### 方法 2：首次访问时授权
1. 刷新浏览器页面
2. 点击 🎤 语音输入按钮
3. 浏览器会弹出权限请求对话框
4. 点击 **允许** (Allow)

---

## 3️⃣ Chrome 浏览器设置

### 检查站点权限：
1. 在地址栏左侧点击 🔒 或 ⓘ 图标
2. 点击 **网站设置** 或 **权限**
3. 找到 **麦克风**
4. 选择 **允许**

### 重置站点权限：
如果之前点击了"阻止"，需要重置：

1. 访问 `chrome://settings/content/microphone`
2. 在 **阻止** 列表中找到 `localhost:8000`
3. 点击右侧的 🗑️ 删除
4. 刷新页面，重新授权

### 清除浏览器缓存：
```
按 Cmd + Shift + Delete（macOS）
选择"Cookies 和其他网站数据"
点击"清除数据"
```

---

## 4️⃣ Safari 浏览器设置

### 网站权限：
1. Safari 菜单 → **设置** (Preferences)
2. 点击 **网站** 选项卡
3. 左侧选择 **麦克风**
4. 找到 `localhost`，设置为 **允许**

### 系统设置：
确保 Safari 有系统级麦克风权限（参考步骤 2）

---

## 5️⃣ Edge 浏览器设置

1. 访问 `edge://settings/content/microphone`
2. 确保 **询问后再访问（推荐）** 已启用
3. 检查 **阻止** 列表，移除 localhost
4. 刷新页面重新授权

---

## 6️⃣ 测试麦克风

### 在线测试：
访问这个网站测试麦克风是否正常工作：
```
https://webcammictest.com/check-mic.html
```

### 检查麦克风硬件：
```bash
# macOS 检查音频设备
system_profiler SPAudioDataType
```

---

## 7️⃣ 常见问题

### 问题：权限已授予但仍然无法使用

**解决方案**：
1. 完全退出并重启浏览器
2. 检查是否有其他应用在使用麦克风（Zoom、Skype 等）
3. 尝试不同的浏览器

### 问题：没有弹出权限请求对话框

**解决方案**：
1. 浏览器可能记住了之前的"阻止"选择
2. 按上面步骤清除站点权限
3. 使用隐私/无痕模式测试

### 问题：点击后立即显示错误

**解决方案**：
1. 打开浏览器控制台（F12 或 Cmd+Option+I）
2. 查看 Console 标签页的错误信息
3. 将错误信息反馈给我

---

## 8️⃣ 备选方案：使用文本输入

如果麦克风问题难以解决，**文本输入功能完全相同且更准确**：

1. 直接在输入框输入问题
2. 按 `Ctrl+Enter` 或点击 **▶️ 开始分析**
3. 功能和语音输入完全一样

**优势**：
- ✅ 更快速
- ✅ 更准确
- ✅ 无需网络调用
- ✅ 支持复杂查询

---

## 🔍 调试模式

### 查看详细错误：

1. 打开浏览器开发者工具（F12）
2. 切换到 **Console** 标签
3. 点击 🎤 语音输入按钮
4. 记录出现的红色错误信息

### 常见错误代码：

| 错误 | 含义 | 解决方案 |
|------|------|----------|
| `NotAllowedError` | 用户拒绝或系统阻止 | 检查浏览器和系统权限 |
| `NotFoundError` | 未找到麦克风设备 | 检查麦克风硬件连接 |
| `NotReadableError` | 麦克风被占用 | 关闭其他使用麦克风的应用 |
| `SecurityError` | 非安全上下文 | 使用 localhost 而非 IP |

---

## 📞 需要帮助？

如果以上方法都无效，请提供：
1. 使用的浏览器和版本（Chrome/Safari/Edge）
2. macOS 版本
3. 浏览器控制台的完整错误信息
4. 系统麦克风权限截图

我们可以进一步诊断问题！


